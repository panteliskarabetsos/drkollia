"use client";

import { useEffect, useState } from "react";

import { useRouter } from "next/navigation";
import { supabase } from "../lib/supabaseClient";
import { ChevronDown, ArrowLeft, ScrollText, IdCard } from "lucide-react";

const faqs = [
  {
    question: "Πώς μπορώ να καταχωρήσω ραντεβού;",
    answer:
      "Μεταβείτε στη σελίδα «Ραντεβού» και πατήστε το κουμπί + που βρίσκεται επάνω δεξιά. Στη συνέχεια, μπορείτε είτε να αναζητήσετε έναν ήδη καταχωρημένο ασθενή πληκτρολογώντας το όνομα, το τηλέφωνο, το email ή το ΑΜΚΑ του, είτε να πατήσετε στο κουμπί «Νέος Ασθενής» για να προσθέσετε καινούργιο. Αφού επιλέξετε την επιθυμητή ημερομηνία, τον λόγο επίσκεψης και την ώρα, πατήστε Καταχώρηση για να ολοκληρώσετε τη διαδικασία. Ο ασθενής θα λάβει αυτόματα email επιβεβαίωσης.",
  },
  {
    question: "Πως μπορώ να ακυρώσω ραντεβού;",
    answer:
      "Μπορείτε να ακυρώσετε οποιδήποτε ραντεβού από τη σελίδα «Ραντεβού». Μετα την ακύρωση, ο ασθενής θα ενημερωθεί αυτόματα μέσω email.",
  },
  {
    question: "Πώς προσθέτω νέο ασθενή;",
    answer:
      "Για να προσθέσετε νέο ασθενή, μεταβείτε στη σελίδα «Ασθενείς» και πατήστε το κουμπί «Νέος Ασθενής». Συμπληρώστε τα απαιτούμενα πεδία και πατήστε 'Δημιουργία Ασθενή'. Στην σελίδα καταχώρησης ασθενούς μπορείτε να καταχωρήσετε όλες τις πληροφορίες του ασθενούς. Νέος ασθενής επίσης δημιουργείται απο την σελίδα «Ραντεβού» όταν καταχωρείτε νέο ραντεβού και επιλέγετε 'Νέος Ασθενής. ",
  },
  {
    question: "Πώς μπορώ να δημιουργήσω νέο λογαριασμό διαχειριστή;",
    answer:
      "Για να δημιουργήσετε νέο λογαριασμό διαχειριστή, μεταβείτε στον πίνακα διαχείρησης, έπειτα επιλέξτε το κουμπί 'Πρόσβαση'. Στην σελίδα διαχείρηση διαχειριστών πατήστε το κουμπί «Νέος Διαχειριστής». Συμπληρώστε τα απαιτούμενα πεδία και πατήστε 'Δημιουργία Λογαριασμού'. Υπενθυμίζεται ότι μόνο οι διαχειριστές μπορούν να δημιουργούν νέους λογαριασμούς διαχειριστών.",
  },
  {
    question: "Πότε στέλνονται αυτοματοποιημένα email στον ασθενή;",
    answer:
      "Το σύστημα στέλνει αυτοματοποιημένα email στον ασθενή μόνο όταν καταχωρείται ένα νέο ραντεβού ή όταν ακυρώνεται υπάρχον ραντεβού. Αυτά τα email περιλαμβάνουν λεπτομέρειες για το ραντεβού και οδηγίες για την επίσκεψη. Επίσης μια μέρα πριν το ραντεβού, ο ασθενής λαμβάνει υπενθύμιση μέσω email για το επερχόμενο ραντεβού του. ",
  },
  {
    question: "Πώς μπορώ να δω το ιστορικό επισκέψεων ενός ασθενούς;",
    answer: (
      <span>
        Στη σελίδα «Ασθενείς» πατήστε στο εικονίδιο{" "}
        <ScrollText className="inline w-4 h-4 text-gray-600" /> (Ιστορικό) δίπλα
        στον ασθενή. Εκεί θα δείτε όλες τις προηγούμενες επισκέψεις με
        ημερομηνία, λόγο επίσκεψης και σημειώσεις.
      </span>
    ),
  },
  {
    question: "Πώς μπορώ να σταματήσω προσωρινά να δέχομαι ραντεβού;",
    answer:
      "Στη σελίδα «Πρόγραμμα Ιατρείου» απενεργοποιήστε τον διακόπτη «Δεχόμαστε νέα ραντεβού». Ο ασθενής δεν θα μπορεί να κλείσει νέο ραντεβού μέχρι να τον ενεργοποιήσετε ξανά.",
  },
  {
    question: "Τι είναι οι Εξαιρέσεις στο πρόγραμμα ιατρείου;",
    answer:
      "Οι «Εξαιρέσεις» χρησιμοποιούνται για να δηλώσετε ημέρες ή ώρες κατά τις οποίες το ιατρείο δεν θα δέχεται ραντεβού, ανεξάρτητα από το βασικό εβδομαδιαίο πρόγραμμα. " +
      "Μπορείτε να τις χρησιμοποιήσετε για περιπτώσεις όπως αργίες, διακοπές, έκτακτα περιστατικά ή όταν θέλετε να κλείσετε συγκεκριμένα χρονικά διαστήματα. " +
      "Αφού καταχωρηθεί μια εξαίρεση, το σύστημα θα αποτρέπει αυτόματα την κράτηση ραντεβού σε αυτές τις ημερομηνίες ή ώρες.",
  },
  {
    question: "Πώς μπορώ να αλλάξω το ωράριο του ιατρείου;",
    answer:
      "Μεταβείτε στη σελίδα «Πρόγραμμα Ιατρείου» από το μενού διαχείρισης. Στην ενότητα «Βασικό Εβδομαδιαίο Πρόγραμμα» μπορείτε να προσθέσετε τις ώρες λειτουργίας για κάθε ημέρα, εισάγωντας χρονικά διαστήματα. " +
      "Για προσωρινές αλλαγές (π.χ. διακοπές, έκτακτα ρεπό), χρησιμοποιήστε την ενότητα «Εξαιρέσεις» για να μπλοκάρετε συγκεκριμένες ημερομηνίες ή ώρες. Οι αλλαγές εφαρμόζονται αυτόματα στο σύστημα κρατήσεων και επηρεάζουν τη διαθεσιμότητα ραντεβού. Αν θέλετε να αλλάξετε το ωράριο για συγκεκριμένες ημέρες, μπορείτε να προσθέσετε εξαιρέσεις για αυτές τις ημέρες. Αν προσθέσετε εξαίρεση σε μέρα ή ωρα με προγραμματισμένο ραντεβού και δεν μπορείτε να το εξυπηρετήσετε, θα πρέπει να το ακυρώσετε χειροκίνητα.",
  },
  {
    question: "Πώς μπορώ να αλλάξω το ωράριο του ιατρείου;",
    answer:
      "Μεταβείτε στη σελίδα «Πρόγραμμα Ιατρείου» από το μενού διαχείρισης. Στην ενότητα «Βασικό Εβδομαδιαίο Πρόγραμμα» μπορείτε να προσθέσετε τις ώρες λειτουργίας για κάθε ημέρα, εισάγωντας χρονικά διαστήματα. " +
      "Για προσωρινές αλλαγές (π.χ. διακοπές, έκτακτα ρεπό), χρησιμοποιήστε την ενότητα «Εξαιρέσεις» για να μπλοκάρετε συγκεκριμένες ημερομηνίες ή ώρες. Οι αλλαγές εφαρμόζονται αυτόματα στο σύστημα κρατήσεων και επηρεάζουν τη διαθεσιμότητα ραντεβού. Αν θέλετε να αλλάξετε το ωράριο για συγκεκριμένες ημέρες, μπορείτε να προσθέσετε εξαιρέσεις για αυτές τις ημέρες. Αν προσθέσετε εξαίρεση σε μέρα ή ωρα με προγραμματισμένο ραντεβού και δεν μπορείτε να το εξυπηρετήσετε, θα πρέπει να το ακυρώσετε χειροκίνητα.",
  },
  {
    question: "Τι σημαίνουν οι στήλες της λίστας;",
    answer:
      "Όνομα, Τηλέφωνο, ΑΜΚΑ, Λόγος Επίσκεψης, Ώρα, Διάρκεια, Κατάσταση (Status), Ενέργειες.",
  },
  {
    question: "Τι σημαίνουν τα status;",
    answer:
      "🟢 approved → Το ραντεβού έχει εγκριθεί. 🔴 cancelled → Το ραντεβού έχει ακυρωθεί. ⚪ completed → Έχει πραγματοποιηθεί και καταγραφεί στο ιστορικό.",
  },
  {
    question: "Πώς εκτυπώνω τη λίστα ραντεβού;",
    answer:
      "Στην σελίδα 'Ραντεβού', στο ημερολόγιο δεξιά, επιλέξτε την ημερομηνία ή το εύρος ημερομηνιών που θέλετε να εκτυπώσετε. Χρησιμοποιήστε το εικονίδιο 🖨️ Εκτύπωση για να εκτυπώσετε τα ραντεβού της επιλεγμένης ημερομηνίας/ων.",
  },
  {
    question: "Πώς κατεβάζω τη λίστα ραντεβού σε αρχείο Excel;",
    answer:
      "Στην σελίδα 'Ραντεβού', στο ημερολόγιο δεξιά, επιλέξτε την ημερομηνία ή το εύρος ημερομηνιών που θέλετε να εξάγετε. Χρησιμοποιήστε το εικονίδιο 📥 Εξαγωγή σε Excel για να κατεβάσετε τα ραντεβού της επιλεγμένης ημερομηνίας/ων σε αρχείο Excel.",
  },
  {
    question: "Τι γίνεται όταν ολοκληρωθεί ένα ραντεβού;",
    answer:
      "Οταν σε ένα ραντεβού επέλθει η ώρα κράτησης χωρίς να ακυρωθεί, το σύστημα το καταγράφει αυτόματα ως completed. Αυτό σημαίνει ότι το ραντεβού έχει πραγματοποιηθεί και η επίσκεψη καταγράφεται στο ιστορικό του ασθενούς.",
  },
  {
    question: "Τι γίνεται όταν ολοκληρωθεί ένα ραντεβού;",
    answer:
      "Οταν σε ένα ραντεβού επέλθει η ώρα κράτησης χωρίς να ακυρωθεί, το σύστημα το καταγράφει αυτόματα ως completed. Αυτό σημαίνει ότι το ραντεβού έχει πραγματοποιηθεί και η επίσκεψη καταγράφεται στο ιστορικό του ασθενούς.",
  },
  {
    question: "Τι σημαίνει η διάρκεια στο ραντεβού;",
    answer:
      "Η διάρκεια δείχνει πόσο διαρκεί το ραντεβού. Ορίζεται κατά τη δημιουργία και μπορεί να αλλάξει από τον διαχειριστή. Το σύστημα δεσμεύει αυτόματα 30 λεπτά για ραντεβού τύπου «Εξέταση» και 15 λεπτά για «Αξιολόγηση» ή «Ιατρικός Επισκέπτης». Μπορείτε να αλλάξετε τη διάρκεια κατά την καταχώρηση του ραντεβού.",
  },
  {
    question: "Μπορούν να κλείσουν ραντεβού ηλεκτρονικά Ιατρικοί επισκέπτες;",
    answer:
      "Ναι, στην σελίδα των ραντεβού υπάρχει επιλογή επίσκεψης για ιατρικούς επισκέπτες. Παρόλα αυτά, το σύστημα επιτρέπει μόνο δύο ραντεβού ανά μήνα για ιατρικούς επισκέπτες. Αν υπάρχουν περισσότεροι Ιατρικοί επισκέπτες που θέλουν να επισκεφθούν το ιατρείο τον συγκεκριμένο μήνα, το σύστημα τους προτρέπει να κλείσουν το ραντεβού τους τηλεφωνικά, διαφορετικά έχουν την επιλογή να κλείσουν ηλεκτρονικά ραντεβού σε μήνα με λιγότερους από δύο υπάρχοντες ιατρικούς επισκέπτες. Αυτό συμβαίνει για να διασφαλιστεί ότι οι ασθενείς έχουν προτεραιότητα στα ραντεβού.",
  },
  {
    question: "Πώς μπορώ να κρατήσω ιστορικό για κάθε ασθενή;",
    answer: (
      <span>
        Για να κρατήσετε ιστορικό, πατήστε το εικονίδιο{" "}
        <ScrollText className="inline w-4 h-4 text-gray-600" /> (Ιστορικό) δίπλα
        στον ασθενή στη σελίδα «Ασθενείς» ή στην σελίδα «Ραντεβού», επιλέγοντας
        το εικονίδιο <IdCard className="inline w-4 h-4 text-gray-600" /> και
        έπειτα το κουμπί «Ιστορικό Ασθενή». Εκεί μπορείτε να καταχωρείτε
        σημειώσεις για κάθε επίσκεψη, όπως διαγνώσεις, θεραπείες και άλλες
        σημαντικές πληροφορίες. Το ιστορικό είναι ορατό μόνο από διαχειριστές
        και παραμένει αποθηκευμένο ακόμη και αν διαγραφούν παλιά ραντεβού.
      </span>
    ),
  },
  {
    question: "Τι αρχείο διατηρείται στο σύστημα;",
    answer:
      "Το σύστημα διατειρεί τις πληροφορίες, στοιχεία επικοινωνίας καθώς και το ιστορικό επισκέψεων για κάθε ασθενή και διατηρείται εως ότου τα διαγράψετε. Τα ραντεβού διατηρούνται στο σύστημα για 1 μήνα και έπειτα διαγράφονται αυτόματα για εξοικονόμηση χώρου της βάσης δεδομένων. ",
  },
];

export default function HelpPage() {
  const [openIndex, setOpenIndex] = useState(null);
  const [openSection, setOpenSection] = useState(null);
  const [sessionChecked, setSessionChecked] = useState(false);
  const [sessionExists, setSessionExists] = useState(false);
  const router = useRouter();

  useEffect(() => {
    const checkAuth = async () => {
      const {
        data: { session },
      } = await supabase.auth.getSession();

      if (!session) {
        router.replace("/login");
      } else {
        setSessionExists(true);
      }
      setSessionChecked(true);
    };
    checkAuth();
  }, [router]);

  const toggleFAQ = (index) => setOpenIndex(openIndex === index ? null : index);
  const toggleSection = (index) =>
    setOpenSection(openSection === index ? null : index);

  if (!sessionChecked) {
    return (
      <main className="min-h-screen flex items-center justify-center">
        Έλεγχος πρόσβασης...
      </main>
    );
  }
  if (!sessionExists) return null;

  return (
    <main className="min-h-screen bg-[#fafafa] text-[#333] font-sans py-26 px-4">
      <div className="max-w-3xl mx-auto">
        <button
          onClick={() => router.back()}
          className="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 mb-6 transition-colors"
        >
          <ArrowLeft className="w-4 h-4" />
          Επιστροφή
        </button>

        <h1 className="text-3xl font-bold text-center mb-8">
          Οδηγός Διαχειριστή & Συχνές Ερωτήσεις
        </h1>

        {/* FAQ */}
        <h2 className="text-xl font-semibold mb-3">Συχνές Ερωτήσεις (FAQ)</h2>
        <div className="space-y-3">
          {faqs.map((faq, index) => (
            <div
              key={index}
              className="border border-gray-200 rounded-lg bg-white shadow-sm"
            >
              <button
                onClick={() => toggleFAQ(index)}
                className="w-full flex justify-between items-center p-4 text-left"
              >
                <span className="font-medium">{faq.question}</span>
                <ChevronDown
                  className={`w-5 h-5 transition-transform ${
                    openIndex === index ? "rotate-180" : ""
                  }`}
                />
              </button>
              {openIndex === index && (
                <div className="px-4 pb-4 text-gray-600">{faq.answer}</div>
              )}
            </div>
          ))}
        </div>
      </div>
    </main>
  );
}
